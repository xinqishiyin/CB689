C51 COMPILER V9.52.0.0   IIC                                                               06/02/2018 13:38:58 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN iic.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE iic.c LARGE OPTIMIZE(6,SPEED) BROWSE INCDIR(G:\CB589P) DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          #include "system.h"
   2          #include "iic.h"
   3          
   4          extern u8 sisessce;
   5          
   6          void I2C_Init(void)
   7          {
   8   1        I2C_SDA_H;
   9   1        delayus(1);
  10   1        I2C_SCL_H;
  11   1      }
  12          
  13          //产生起始信号
  14          void I2C_Start(void)
  15          { 
  16   1        I2C_SDA_H;
  17   1        I2C_SCL_H;
  18   1        delayus(1);
  19   1        I2C_SDA_L;
  20   1        delayus(1);
  21   1        I2C_SCL_L;
  22   1      }
  23          
  24          //产生停止信号
  25          void I2C_Stop(void)
  26          {   
  27   1         //I2C_SCL_L;
  28   1         I2C_SDA_L;
  29   1         delayus(1);
  30   1         I2C_SCL_H;
  31   1         delayus(1);
  32   1         I2C_SDA_H;
  33   1         delayus(1);
  34   1      }
  35          
  36          
  37          //主机产生应答信号ACK
  38          void I2C_Ack()
  39          { 
  40   1         I2C_SDA_L;
  41   1         delayus(1);
  42   1         I2C_SCL_H;
  43   1         delayus(2);
  44   1         I2C_SCL_L;
  45   1      }
  46          void I2C_NAck()
  47          {
  48   1         I2C_SDA_H;
  49   1         delayus(1);
  50   1         I2C_SCL_H;
  51   1         delayus(2);
  52   1         I2C_SCL_L;
  53   1      } 
  54          
C51 COMPILER V9.52.0.0   IIC                                                               06/02/2018 13:38:58 PAGE 2   

  55          //等待从机应答信号
  56          //返回值：1 接收应答失败
  57          //      0 接收应答成功
  58          u8 I2C_Wait_Ack(void)
  59          {
  60   1        u8 tempTime=0;
  61   1        I2C_SCL_L;
  62   1        I2C_SDA_IN;
  63   1        I2C_SCL_H;
  64   1        delayus(1); 
  65   1        while(I2C_SDA)
  66   1        {
  67   2          tempTime++;
  68   2          if(tempTime>250)
  69   2          {
  70   3            sisessce=0;
  71   3            I2C_Stop();
  72   3            I2C_SDA_OUT;
  73   3            return 1;
  74   3          }  
  75   2        }
  76   1        I2C_SCL_L;
  77   1        I2C_SDA_OUT;
  78   1        delayus(2);
  79   1        return 0;
  80   1      }
  81          
  82          
  83          //I2C 发送一个字节
  84          void I2C_Send_Byte(u8 txd)
  85          {
  86   1        u8 i=0;
  87   1        I2C_SCL_L;//拉低时钟开始数据传输
  88   1      
  89   1        for(i=0;i<8;i++)
  90   1        {
  91   2          if((txd&0x80)>0) //0x80  1000 0000
  92   2            I2C_SDA_H;
  93   2          else
  94   2            I2C_SDA_L;
  95   2      
  96   2          txd<<=1;
  97   2          I2C_SCL_H;
  98   2          delayus(1); //发送数据
  99   2          I2C_SCL_L;
 100   2          delayus(1);
 101   2        }
 102   1      }
 103          
 104          
 105          //I2C 读取一个字节
 106          
 107          u8 I2C_Read_Byte()
 108          {
 109   1         u8 i,receive;
 110   1         I2C_SCL_L; 
 111   1        delayus(2);
 112   1         I2C_SDA_IN;
 113   1         delayus(2);
 114   1         for(i=0;i<8;i++)
 115   1         {
 116   2            receive<<=1;
C51 COMPILER V9.52.0.0   IIC                                                               06/02/2018 13:38:58 PAGE 3   

 117   2            if(I2C_SDA==1) receive|=0x01;
 118   2            I2C_SCL_H;  
 119   2            delayus(2);
 120   2            I2C_SCL_L;      
 121   2            delayus(1); 
 122   2         }
 123   1        I2C_SDA_OUT;
 124   1        return receive;
 125   1      }
 126          
 127          
 128          
 129          
 130          
 131          
 132          
 133          
 134          
 135          
 136          
 137          
 138          
 139          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    387    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
