C51 COMPILER V9.52.0.0   VCO                                                               06/02/2018 13:38:53 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE VCO
OBJECT MODULE PLACED IN vco.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE vco.c LARGE OPTIMIZE(6,SPEED) BROWSE INCDIR(G:\CB589P) DEBUG OBJECTEXTEND T
                    -ABS(2)

line level    source

   1          #include "system.h"
   2          #include "vco.h"
   3          
   4          /***************************************修改记录*****************************************************
   5           Function List：
   6              1、calculateFreq       4802VCO  频率计算
   7           Change Log:
   8          
   9          
  10          ****************************************************************************************************/
  11          xdata u8   NDIV_FRE=80;
  12          xdata tVcoParam mVcoParam;
  13          
  14          
  15          
  16          /*-------------------------------------------------------------------------
  17          *函数：calculateFreq  计算发射 接收频率  保存到  mXn31202Ch1_Rx  和 mXn31202Ch1_Tx
  18          *参数：mCbParam.Channel   信道号     mCbParam.Country 国家制式  cFreqStep 步进  
  19          *返回值：无
  20          *-------------------------------------------------------------------------*/
  21          void calculateFreq(void)
  22          {
  23   1        double temp;
  24   1        u32 mCurrentFreq = 0;   //当前信道的频率，通过信道1和步进频率计算
  25   1        //
  26   1        switch(mCbParam.Country)
  27   1        {
  28   2          /*-----------table1------------*/
  29   2          case COUNTRY_EU:
  30   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
  31   2            else if(mCbParam.Channel<=22)
  32   2            {
  33   3              switch((mCbParam.Channel-1)%4)
  34   3              {
  35   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
  36   4                  break;
  37   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
  38   4                  break;
  39   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
  40   4                  break;
  41   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
  42   4                  break;    
  43   4                default:
  44   4                  break;
  45   4              }       
  46   3            }
  47   2            else if(mCbParam.Channel==23) mCurrentFreq=27255 ;
  48   2            else if(mCbParam.Channel==24) mCurrentFreq=27235 ;
  49   2            else if(mCbParam.Channel==25) mCurrentFreq=27245 ;
  50   2            else mCurrentFreq=27265 +(mCbParam.Channel-26)*10;   
  51   2            break;
  52   2          case COUNTRY_CE:
  53   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
  54   2            else if(mCbParam.Channel<=22)
C51 COMPILER V9.52.0.0   VCO                                                               06/02/2018 13:38:53 PAGE 2   

  55   2            {
  56   3              switch((mCbParam.Channel-1)%4)
  57   3              {
  58   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
  59   4                  break;
  60   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
  61   4                  break;
  62   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
  63   4                  break;
  64   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
  65   4                  break;          
  66   4              }       
  67   3            }     
  68   2            else if(mCbParam.Channel==23) mCurrentFreq=27255 ;
  69   2            else if(mCbParam.Channel==24) mCurrentFreq=27235 ;
  70   2            else if(mCbParam.Channel==25) mCurrentFreq=27245 ;
  71   2            else mCurrentFreq=27265 +(mCbParam.Channel-26)*10;  
  72   2            break;
  73   2          case COUNTRY_UK:
  74   2            mCurrentFreq=27601+(mCbParam.Channel-1)*10;
  75   2            break;
  76   2          case COUNTRY_PL:
  77   2            if(mCbParam.Channel==1) mCurrentFreq= 26960;
  78   2            else if(mCbParam.Channel<=22)
  79   2            {
  80   3              switch((mCbParam.Channel-1)%4)
  81   3              {
  82   4                case 0:mCurrentFreq=26960 +(mCbParam.Channel-1)/4*50;
  83   4                  break;
  84   4                case 1:mCurrentFreq=26960 +(mCbParam.Channel-1)/4*50+10;
  85   4                  break;
  86   4                case 2:mCurrentFreq=26960 +(mCbParam.Channel-1)/4*50+20;
  87   4                  break;
  88   4                case 3:mCurrentFreq=26960 +(mCbParam.Channel-1)/4*50+40;
  89   4                  break;          
  90   4              }       
  91   3            }     
  92   2            else if(mCbParam.Channel==23) mCurrentFreq=27250 ;
  93   2            else if(mCbParam.Channel==24) mCurrentFreq=27230 ;
  94   2            else if(mCbParam.Channel==25) mCurrentFreq=27240 ;
  95   2            else mCurrentFreq=27260 +(mCbParam.Channel-26)*10;    
  96   2            break;
  97   2          case COUNTRY_I0:
  98   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
  99   2            else if(mCbParam.Channel<=22)
 100   2            {
 101   3              switch((mCbParam.Channel-1)%4)
 102   3              {
 103   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
 104   4                  break;
 105   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
 106   4                  break;
 107   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
 108   4                  break;
 109   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
 110   4                  break;          
 111   4              }       
 112   3            }     
 113   2            else if(mCbParam.Channel==23) mCurrentFreq=27255;
 114   2            else if(mCbParam.Channel==24) mCurrentFreq=27235;
 115   2            else if(mCbParam.Channel==25) mCurrentFreq=27245;
 116   2            else if(mCbParam.Channel<=40) mCurrentFreq=27265+(mCbParam.Channel-26)*10;
C51 COMPILER V9.52.0.0   VCO                                                               06/02/2018 13:38:53 PAGE 3   

 117   2            break;
 118   2          case COUNTRY_I2:
 119   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
 120   2            else if(mCbParam.Channel<=22)
 121   2            {
 122   3              switch((mCbParam.Channel-1)%4)
 123   3              {
 124   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
 125   4                  break;
 126   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
 127   4                  break;
 128   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
 129   4                  break;
 130   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
 131   4                  break;          
 132   4              }       
 133   3            }       
 134   2            else if(mCbParam.Channel==23) mCurrentFreq=27255;
 135   2            else if(mCbParam.Channel==24) mCurrentFreq=27245;
 136   2            else if(mCbParam.Channel<=34) mCurrentFreq=26865+ (mCbParam.Channel-25)*10;
 137   2            //else if(mCbParam.Channel==35) mCurrentFreq=26855;
 138   2            //else if(mCbParam.Channel==36) mCurrentFreq=26865;
 139   2            break;
 140   2          case COUNTRY_DE:
 141   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
 142   2            else if(mCbParam.Channel<=22)
 143   2            {
 144   3              switch((mCbParam.Channel-1)%4)
 145   3              {
 146   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
 147   4                  break;
 148   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
 149   4                  break;
 150   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
 151   4                  break;
 152   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
 153   4                  break;          
 154   4              }
 155   3            }       
 156   2            else if(mCbParam.Channel==23) mCurrentFreq=27255;
 157   2            else if(mCbParam.Channel==24) mCurrentFreq=27235;
 158   2            else if(mCbParam.Channel==25) mCurrentFreq=27245;
 159   2            else if(mCbParam.Channel<=40) mCurrentFreq=27265+(mCbParam.Channel-26)*10;
 160   2            else mCurrentFreq=26565+(mCbParam.Channel-41)*10;
 161   2            break;
 162   2          case COUNTRY_IN:
 163   2            if(mCbParam.Channel==1) mCurrentFreq= 26965;
 164   2            else if(mCbParam.Channel<=22)
 165   2            {
 166   3              switch((mCbParam.Channel-1)%4)
 167   3              {
 168   4                case 0:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50;
 169   4                  break;
 170   4                case 1:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+10;
 171   4                  break;
 172   4                case 2:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+20;
 173   4                  break;
 174   4                case 3:mCurrentFreq=26965 +(mCbParam.Channel-1)/4*50+40;
 175   4                  break;          
 176   4              }       
 177   3            }       
 178   2            else if(mCbParam.Channel==23) mCurrentFreq=27255;
C51 COMPILER V9.52.0.0   VCO                                                               06/02/2018 13:38:53 PAGE 4   

 179   2            else if(mCbParam.Channel==24) mCurrentFreq=27235;
 180   2            else if(mCbParam.Channel==25) mCurrentFreq=27245;
 181   2            else if(mCbParam.Channel==26) mCurrentFreq=27265;
 182   2            else if(mCbParam.Channel==27) mCurrentFreq=27275;
 183   2            break;
 184   2          /*-----------table2-----------*/
 185   2          case COUNTRY_RU:
 186   2            if(mCbParam.Channel==1) mCurrentFreq= mCbParam.Band*450+25615;
 187   2            else if(mCbParam.Channel<=22)
 188   2            {
 189   3              switch((mCbParam.Channel-1)%4)
 190   3              {
 191   4                case 0:mCurrentFreq=25615 +(mCbParam.Channel-1)/4*50+mCbParam.Band*450;
 192   4                  break;
 193   4                case 1:mCurrentFreq=25615 +(mCbParam.Channel-1)/4*50+10+ mCbParam.Band*450;
 194   4                  break;
 195   4                case 2:mCurrentFreq=25615 +(mCbParam.Channel-1)/4*50+20+ mCbParam.Band*450;
 196   4                  break;
 197   4                case 3:mCurrentFreq=25615 +(mCbParam.Channel-1)/4*50+40+ mCbParam.Band*450;
 198   4                  break;          
 199   4              }       
 200   3            }     
 201   2            else if(mCbParam.Channel==23) mCurrentFreq=25905+ mCbParam.Band*450 ;
 202   2            else if(mCbParam.Channel==24) mCurrentFreq=25885+ mCbParam.Band*450 ;
 203   2            else if(mCbParam.Channel==25) mCurrentFreq=25895+ mCbParam.Band*450 ;
 204   2            else mCurrentFreq=25915+ mCbParam.Band*450 +(mCbParam.Channel-26)*10; 
 205   2           
 206   2            break;
 207   2          case COUNTRY_HX:
 208   2            mCurrentFreq=28.000 + (mCbParam.Channel-1)*0.005 + mCbParam.Band*0.2;   
 209   2            break;  
 210   2          default:
 211   2            break;
 212   2        }
 213   1        
 214   1        
 215   1        temp=((double)mCurrentFreq)/1000; 
 216   1        if(mCbParam.Country==COUNTRY_UK) 
 217   1        {
 218   2          temp+=0.00025;
 219   2        }
 220   1        //temp=27.6683;
 221   1      
 222   1        //mCurrentFreq=(26.5078+((temp+IF+IF4802)-38.556)*20/29.093)*mVcoParam.NDIV_FRE*8388608/21.7;//29.095????
 223   1        mCurrentFreq=(temp+ CAFREQ+ IF4802)*mVcoParam.NDIV_FRE*BK4802_EXP;
 224   1        mVcoParam.h_Fre_Rx=mCurrentFreq>>16;
 225   1        mVcoParam.l_Fre_Rx=mCurrentFreq;
 226   1        if (mCbParam.Modu==AM && mMenu.isTx == 0)
 227   1        {
 228   2          //36.310-40.805  四等分 并取每等分的中间值做计算
 229   2          if (temp < 26.733)
 230   2          {
 231   3            mCurrentFreq = (FADE_1 + ((temp + IF) - 36.872) * BK4802_FADE_EXP)*mVcoParam.NDIV_FRE * BK4802_EXP;//29
             -.095
 232   3          }
 233   2          else if (temp < 27.856)
 234   2          {
 235   3            mCurrentFreq = (FADE_2 + ((temp + IF ) - 37.995) * BK4802_FADE_EXP)*mVcoParam.NDIV_FRE * BK4802_EXP;//2
             -9.095
 236   3          }
 237   2          else if (temp < 28.979)
 238   2          {
C51 COMPILER V9.52.0.0   VCO                                                               06/02/2018 13:38:53 PAGE 5   

 239   3            mCurrentFreq = (FADE_3 + ((temp + IF ) - 39.118) * BK4802_FADE_EXP)*mVcoParam.NDIV_FRE * BK4802_EXP;//2
             -9.095
 240   3          }
 241   2          else
 242   2          {
 243   3            mCurrentFreq = (FADE_4 + ((temp + IF ) - 40.244) * BK4802_FADE_EXP)*mVcoParam.NDIV_FRE * BK4802_EXP;//2
             -9.095
 244   3          }
 245   2        }
 246   1        else
 247   1        {
 248   2          mCurrentFreq = (temp + CAFREQ )*mVcoParam.NDIV_FRE * BK4802_EXP;    
 249   2        } 
 250   1        //mCurrentFreq=(temp+0.00335)*mVcoParam.NDIV_FRE*8388608/21.7;    //天气预报段  161-163   NDIV=24  REG2  0
             -x2000
 251   1        
 252   1        mVcoParam.h_Fre_Tx=mCurrentFreq>>16;
 253   1        mVcoParam.l_Fre_Tx=mCurrentFreq;
 254   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3779    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     11       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
